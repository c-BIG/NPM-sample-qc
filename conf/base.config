/* -------------------------------------------------
 *  Base Nextflow config file
 * -------------------------------------------------
 * This file contains basic process requirement setup. It DOES NOT
 * contain any config for cluster, so will run in default mode by
 * itself.
 */
process {

    //errorStrategy = { (task.exitStatus in 137..140 && task.attempt <= maxRetries)  ? 'retry' : 'finish' }
    //errorStrategy = { task.attempt <= maxRetries  ? 'retry' : 'terminate' }
    //errorStrategy = { task.attempt <= maxRetries  ? 'retry' : 'finish' }
    //errorStrategy = { task.attempt < 2 ? 'retry' : 'finish' }

    errorStrategy = { (task.exitStatus in [124,143,137,104,134,139] && task.attempt <= maxRetries)  ? 'retry' : 'finish' }
    maxRetries = 2

    withName:cram_bam_index {
        cpus = 4
        disk = '1 GB'
        memory = '1 GB'
    }
    withName:samtools_stats {
        cpus = 4
        disk = '1 GB'
        memory = '1 GB'
    }
    withName:samtools_flagstat {
        cpus = 4
        disk = '1 GB'
        memory = '1 GB'
    }
    withName:bcftools_stats {
        cpus = 4
        disk = '1 GB'
        memory = '1 GB'
    }
    withName:bcftools_gtcheck {
        cpus = 4
        disk = '1 GB'
        memory = '1 GB'
    }
    withName:mosdepth {
        cpus = 4
        disk = '2 GB'
        memory = '2 GB'
    }
    withName:picard_collect_variant_calling_metrics_vcf {
        cpus = 4
        disk = '2 GB'
        memory = '2 GB'
    }
    withName:picard_collect_variant_calling_metrics_gvcf {
        cpus = 4
        disk = '2 GB'
        memory = '2 GB'
    }
    withName:picard_collect_multiple_metrics {
        cpus = 4
        disk = '2 GB'
        memory = '2 GB'
    }
    withName:picard_collect_wgs_metrics {
        cpus = 8
        disk = '4 GB'
        memory = '4 GB'
    }
    withName:count_variants {
        cpus = 2
        disk = '1 GB'
        memory = '1 GB'
    }
    withName:verifybamid2 {
        cpus = 2
        disk = '2 GB'
        memory = '2 GB'
    }
    withName:plot_bamstats {
        cpus = 1
        disk = '1 GB'
        memory = '1 GB'
    }
    withName:multiqc {
        cpus = 1
        disk = '1 GB'
        memory = '1 GB'
    }
    withName:compile_metrics {
        cpus = 1
        disk = '1 GB'
        memory = '1 GB'
    }
}
